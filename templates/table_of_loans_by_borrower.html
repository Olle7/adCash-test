<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Table of loans</title>
    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }
    </style>

    <style>
        .context-menu {
            position: absolute;
            z-index: 1000;
            width: 120px;
            background-color: #fff;
            border: 1px solid #888;
            box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.3);
            padding: 4px 0;
            list-style: none;
        }

        .context-menu li {
            padding: 4px 12px;
            cursor: pointer;
        }

        .context-menu li:hover {
            background-color: #ddd;
        }

        .context-menu li.disabled {
            opacity: 0.5;
            cursor: default;
        }
    </style>


</head>
<body>
<h1>List of all loans from given borrower</h1>
<label for="borrower_ID">insert personal ID of borrower:</label>
<input type="text" id="borrower_ID">
<button onclick="load_data()">load</button>
<br><br>

<div>
    <label for="searchInput">Search:</label>
    <input type="text" id="searchInput" oninput="fill_table()" />
</div>


<table id="Table_of_loans">
    <thead>
    <tr>
        <th>amount</th>
        <th>currency</th>
        <th>term</th>
        <th>name</th>
        <th>persoal ID</th>
        <th>contact</th>
        <th>type of contact</th>
        <th>Comments</th>
        <th>time of application</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<script>
function freeCriteriaFilter(rowData, searchQuery) {
  if (searchQuery === "") {
    return true;
  }
  for (let i = 0; i < rowData.length; i++) {
    const fieldValue = rowData[i];
    if (
      fieldValue &&
      typeof fieldValue === "string" &&
      fieldValue.toLowerCase().includes(searchQuery.toLowerCase())
    ) {
      return true;
    }
  }
  return false;
}

function fill_table() {
  const tableBody = document.querySelector("#Table_of_loans tbody");

  tableBody.innerHTML = "";

  const searchQuery = document.getElementById("searchInput").value;
  for (let i = 0; i < list_with_loans.length; i += 9) {
    if (!freeCriteriaFilter(list_with_loans.slice(i, i + 9), searchQuery)) {
      continue;
    }
    const row = tableBody.insertRow();
    for (let i2 = i; i2 < i + 9; i2++) {
      const cell = row.insertCell();
      cell.textContent = list_with_loans[i2];
    }
  };
}

function load_data() {
  const url = "http://127.0.0.1:5000/list_of_loans_by_borrower?personal_ID=";

  fetch(url + document.getElementById("borrower_ID").value)
    .then(response => response.json())
    .then(data => {
      list_with_loans = data;
      fill_table();
    })
    .catch(error => console.error(error));
}
</script>

</body>
</html>